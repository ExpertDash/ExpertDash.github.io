var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
import { Collider, GravitySystem, Model, Motion, MotionSystem, Name, RenderSystem, TextSystem, Transform } from "../../common/lib.js";
import { Ball, Controllable, CpuController, Ownership, Wall } from "./components/lib.js";
import { BallSystem, CpuSystem } from "./systems/lib.js";
import World, { Simulator } from "../../common/world.js";
import { System } from "../../ecs.js";
import Vector3, { vec3 } from "../../math/vec3.js";
import Material from "../../rendering/material.js";
import Mesh from "../../rendering/mesh.js";
import Shader from "../../rendering/shader.js";
async function play(mode) {
    document.querySelector("#menu").style.display = "none";
    document.querySelector("canvas").style.display = "block";
    let renderSystem = World.systems.get(RenderSystem);
    renderSystem.size = 0.015;
    let shader = await Shader.load("./resources/shaders/flat.glsl");
    let mat = new Material(shader).setValue("color", [1, 1, 1]);
    let ball = World.entities.create(new Name("Ball"), new Transform({ scale: vec3(0.2, 0.2, 1) }), new Model(Mesh.Primitives.quad, mat), Collider, Motion, Ball);
    let leftBoard = World.entities.create(new Name("Right Board"), new Transform({ position: vec3(-Pong.width * 0.425, 0), scale: vec3(0.2, 1, 1) }), new Model(Mesh.Primitives.quad, mat), Collider);
    let rightBoard = World.entities.create(new Name("Right Board"), new Transform({ position: vec3(Pong.width * 0.425, 0), scale: vec3(0.2, 1, 1) }), new Model(Mesh.Primitives.quad, mat), Collider);
    World.entities.create(new Transform({ position: Vector3.back, scale: vec3(Pong.width * 0.525, Pong.height * 0.54, 1) }), new Model(Mesh.Primitives.quad, new Material(shader).setValue("color", [1, 1, 1])), Wall);
    World.entities.create(new Transform({ position: Vector3.back, scale: vec3(Pong.width * 0.5, Pong.height * 0.5, 1) }), new Model(Mesh.Primitives.quad, new Material(shader).setValue("color", [0, 0, 0])));
    switch (mode) {
        case "sp":
            leftBoard.add(Controllable);
            rightBoard.add(new CpuController(0.2));
            break;
        case "host":
            World.systems.remove(CpuSystem);
            leftBoard.add(Ownership, Controllable);
            ball.add(Ownership);
            break;
        default:
            World.systems.remove(MotionSystem, BallSystem, CpuSystem);
            rightBoard.add(Ownership, Controllable);
            break;
    }
    console.log([...World.systems]);
    console.log(Mesh.Primitives.quad);
    World.systems.remove(GravitySystem);
    World.systems.get(RenderSystem).fit();
    Pong.resetRound();
}
document.querySelector("#sp").addEventListener("click", () => play("sp"));
document.querySelector("#host").addEventListener("click", () => play("host"));
document.querySelector("#join").addEventListener("click", () => play("guest"));
document.querySelector("#code > input").addEventListener("keydown", e => {
    switch (e.keyCode) {
        case 13:
            play("guest");
            break;
    }
});
function hasParameter(name) {
    return location.hash.slice(1).split(',').indexOf(name) != -1;
}
if (hasParameter("singleplayer"))
    play("sp");
export default class Pong {
    static resetRound() {
        World.entities.forEach((ball, motion, transform) => {
            let speed = 0.2;
            let angle = Math.round(Math.random() * 15) * Math.PI / 7;
            motion.velocity = new Vector3(Math.cos(angle), Math.sin(angle)).mul(0.2);
            transform.position = new Vector3(0, (Math.random() - 0.5) * Pong.height);
            if (hasParameter("deterministic")) {
                motion.velocity = new Vector3(-speed);
                transform.position = Vector3.zero;
            }
        }, Ball, Motion, Transform);
        Simulator.resume();
    }
    static get width() {
        return 12;
    }
    static get height() {
        return 8;
    }
}
let DebugSystem = class DebugSystem extends System {
    update(entities) {
        let textSystem = World.systems.get(TextSystem);
        entities.forEach((transform, name) => {
            textSystem.text(transform.position, `${name}`, { color: "dimgray" });
        }, Transform, Name);
    }
};
DebugSystem = __decorate([
    World.register.system(Simulator.phase(Simulator.Category.UI, { after: [TextSystem] }))
], DebugSystem);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9nYW1lcy9wb25nL21haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFDLFFBQVEsRUFBRSxhQUFhLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxZQUFZLEVBQUUsSUFBSSxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsU0FBUyxFQUFDLE1BQU0scUJBQXFCLENBQUE7QUFDbkksT0FBTyxFQUFDLElBQUksRUFBRSxZQUFZLEVBQUUsYUFBYSxFQUFFLFNBQVMsRUFBRSxJQUFJLEVBQUMsTUFBTSxxQkFBcUIsQ0FBQTtBQUN0RixPQUFPLEVBQUMsVUFBVSxFQUFFLFNBQVMsRUFBQyxNQUFNLGtCQUFrQixDQUFBO0FBQ3RELE9BQU8sS0FBSyxFQUFFLEVBQUMsU0FBUyxFQUFDLE1BQU0sdUJBQXVCLENBQUE7QUFDdEQsT0FBTyxFQUFXLE1BQU0sRUFBQyxNQUFNLGNBQWMsQ0FBQTtBQUM3QyxPQUFPLE9BQU8sRUFBRSxFQUFDLElBQUksRUFBQyxNQUFNLG9CQUFvQixDQUFBO0FBQ2hELE9BQU8sUUFBUSxNQUFNLDZCQUE2QixDQUFBO0FBQ2xELE9BQU8sSUFBSSxNQUFNLHlCQUF5QixDQUFBO0FBQzFDLE9BQU8sTUFBTSxNQUFNLDJCQUEyQixDQUFBO0FBSTlDLEtBQUssVUFBVSxJQUFJLENBQUMsSUFBVTtJQUM3QixRQUFRLENBQUMsYUFBYSxDQUFjLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLEdBQUcsTUFBTSxDQUFBO0lBQ25FLFFBQVEsQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFDLENBQUMsS0FBSyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUE7SUFFeEQsSUFBSSxZQUFZLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsWUFBWSxDQUFDLENBQUE7SUFDbEQsWUFBWSxDQUFDLElBQUksR0FBRyxLQUFLLENBQUE7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LE1BQU0sQ0FBQyxTQUFTLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRSxFQUFFLEVBQUMsS0FBSyxFQUFFLENBQUMsVUFBVSxDQUFDLEVBQUMsQ0FBQyxDQUFDO0dBQy9FLFdBQVcsQ0FRaEIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0NvbGxpZGVyLCBHcmF2aXR5U3lzdGVtLCBNb2RlbCwgTW90aW9uLCBNb3Rpb25TeXN0ZW0sIE5hbWUsIFJlbmRlclN5c3RlbSwgVGV4dFN5c3RlbSwgVHJhbnNmb3JtfSBmcm9tIFwiLi4vLi4vY29tbW9uL2xpYi5qc1wiXHJcbmltcG9ydCB7QmFsbCwgQ29udHJvbGxhYmxlLCBDcHVDb250cm9sbGVyLCBPd25lcnNoaXAsIFdhbGx9IGZyb20gXCIuL2NvbXBvbmVudHMvbGliLmpzXCJcclxuaW1wb3J0IHtCYWxsU3lzdGVtLCBDcHVTeXN0ZW19IGZyb20gXCIuL3N5c3RlbXMvbGliLmpzXCJcclxuaW1wb3J0IFdvcmxkLCB7U2ltdWxhdG9yfSBmcm9tIFwiLi4vLi4vY29tbW9uL3dvcmxkLmpzXCJcclxuaW1wb3J0IHtFbnRpdGllcywgU3lzdGVtfSBmcm9tIFwiLi4vLi4vZWNzLmpzXCJcclxuaW1wb3J0IFZlY3RvcjMsIHt2ZWMzfSBmcm9tIFwiLi4vLi4vbWF0aC92ZWMzLmpzXCJcclxuaW1wb3J0IE1hdGVyaWFsIGZyb20gXCIuLi8uLi9yZW5kZXJpbmcvbWF0ZXJpYWwuanNcIlxyXG5pbXBvcnQgTWVzaCBmcm9tIFwiLi4vLi4vcmVuZGVyaW5nL21lc2guanNcIlxyXG5pbXBvcnQgU2hhZGVyIGZyb20gXCIuLi8uLi9yZW5kZXJpbmcvc2hhZGVyLmpzXCJcclxuXHJcbnR5cGUgTW9kZSA9IFwic3BcIiB8IFwiaG9zdFwiIHwgXCJndWVzdFwiXHJcblxyXG5hc3luYyBmdW5jdGlvbiBwbGF5KG1vZGU6IE1vZGUpOiBQcm9taXNlPHZvaWQ+IHtcclxuXHRkb2N1bWVudC5xdWVyeVNlbGVjdG9yPEhUTUxFbGVtZW50PihcIiNtZW51XCIpLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIlxyXG5cdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJjYW52YXNcIikuc3R5bGUuZGlzcGxheSA9IFwiYmxvY2tcIlxyXG5cclxuXHRsZXQgcmVuZGVyU3lzdGVtID0gV29ybGQuc3lzdGVtcy5nZXQoUmVuZGVyU3lzdGVtKVxyXG5cdHJlbmRlclN5c3RlbS5zaXplID0gMC4wMTVcclxuXHJcblx0bGV0IHNoYWRlciA9IGF3YWl0IFNoYWRlci5sb2FkKFwiLi9yZXNvdXJjZXMvc2hhZGVycy9mbGF0Lmdsc2xcIilcclxuXHRsZXQgbWF0ID0gbmV3IE1hdGVyaWFsKHNoYWRlcikuc2V0VmFsdWUoXCJjb2xvclwiLCBbMSwgMSwgMV0pXHJcblxyXG5cdGxldCBiYWxsID0gV29ybGQuZW50aXRpZXMuY3JlYXRlKFxyXG5cdFx0bmV3IE5hbWUoXCJCYWxsXCIpLFxyXG5cdFx0bmV3IFRyYW5zZm9ybSh7c2NhbGU6IHZlYzMoMC4yLCAwLjIsIDEpfSksXHJcblx0XHRuZXcgTW9kZWwoTWVzaC5QcmltaXRpdmVzLnF1YWQsIG1hdCksXHJcblx0XHRDb2xsaWRlcixcclxuXHRcdE1vdGlvbixcclxuXHRcdEJhbGxcclxuXHQpXHJcblxyXG5cdGxldCBsZWZ0Qm9hcmQgPSBXb3JsZC5lbnRpdGllcy5jcmVhdGUoXHJcblx0XHRuZXcgTmFtZShcIlJpZ2h0IEJvYXJkXCIpLFxyXG5cdFx0bmV3IFRyYW5zZm9ybSh7cG9zaXRpb246IHZlYzMoLVBvbmcud2lkdGggKiAwLjQyNSwgMCksIHNjYWxlOiB2ZWMzKDAuMiwgMSwgMSl9KSxcclxuXHRcdG5ldyBNb2RlbChNZXNoLlByaW1pdGl2ZXMucXVhZCwgbWF0KSxcclxuXHRcdENvbGxpZGVyXHJcblx0KVxyXG5cclxuXHRsZXQgcmlnaHRCb2FyZCA9IFdvcmxkLmVudGl0aWVzLmNyZWF0ZShcclxuXHRcdG5ldyBOYW1lKFwiUmlnaHQgQm9hcmRcIiksXHJcblx0XHRuZXcgVHJhbnNmb3JtKHtwb3NpdGlvbjogdmVjMyhQb25nLndpZHRoICogMC40MjUsIDApLCBzY2FsZTogdmVjMygwLjIsIDEsIDEpfSksXHJcblx0XHRuZXcgTW9kZWwoTWVzaC5QcmltaXRpdmVzLnF1YWQsIG1hdCksXHJcblx0XHRDb2xsaWRlclxyXG5cdClcclxuXHJcblx0V29ybGQuZW50aXRpZXMuY3JlYXRlKFxyXG5cdFx0bmV3IFRyYW5zZm9ybSh7cG9zaXRpb246IFZlY3RvcjMuYmFjaywgc2NhbGU6IHZlYzMoUG9uZy53aWR0aCAqIDAuNTI1LCBQb25nLmhlaWdodCAqIDAuNTQsIDEpfSksXHJcblx0XHRuZXcgTW9kZWwoTWVzaC5QcmltaXRpdmVzLnF1YWQsIG5ldyBNYXRlcmlhbChzaGFkZXIpLnNldFZhbHVlKFwiY29sb3JcIiwgWzEsIDEsIDFdKSksXHJcblx0XHRXYWxsXHJcblx0KVxyXG5cclxuXHRXb3JsZC5lbnRpdGllcy5jcmVhdGUoXHJcblx0XHRuZXcgVHJhbnNmb3JtKHtwb3NpdGlvbjogVmVjdG9yMy5iYWNrLCBzY2FsZTogdmVjMyhQb25nLndpZHRoICogMC41LCBQb25nLmhlaWdodCAqIDAuNSwgMSl9KSxcclxuXHRcdG5ldyBNb2RlbChNZXNoLlByaW1pdGl2ZXMucXVhZCwgbmV3IE1hdGVyaWFsKHNoYWRlcikuc2V0VmFsdWUoXCJjb2xvclwiLCBbMCwgMCwgMF0pKVxyXG5cdClcclxuXHJcblx0c3dpdGNoKG1vZGUpIHtcclxuXHRcdGNhc2UgXCJzcFwiOlxyXG5cdFx0XHRsZWZ0Qm9hcmQuYWRkKENvbnRyb2xsYWJsZSlcclxuXHRcdFx0cmlnaHRCb2FyZC5hZGQobmV3IENwdUNvbnRyb2xsZXIoMC4yKSlcclxuXHRcdFx0YnJlYWtcclxuXHRcdGNhc2UgXCJob3N0XCI6XHJcblx0XHRcdFdvcmxkLnN5c3RlbXMucmVtb3ZlKENwdVN5c3RlbSlcclxuXHJcblx0XHRcdGxlZnRCb2FyZC5hZGQoT3duZXJzaGlwLCBDb250cm9sbGFibGUpXHJcblx0XHRcdGJhbGwuYWRkKE93bmVyc2hpcClcclxuXHRcdFx0YnJlYWtcclxuXHRcdGRlZmF1bHQ6XHJcblx0XHRcdFdvcmxkLnN5c3RlbXMucmVtb3ZlKFxyXG5cdFx0XHRcdE1vdGlvblN5c3RlbSxcclxuXHRcdFx0XHRCYWxsU3lzdGVtLFxyXG5cdFx0XHRcdENwdVN5c3RlbVxyXG5cdFx0XHQpXHJcblxyXG5cdFx0XHRyaWdodEJvYXJkLmFkZChPd25lcnNoaXAsIENvbnRyb2xsYWJsZSlcclxuXHRcdFx0YnJlYWtcclxuXHR9XHJcblxyXG5cdGNvbnNvbGUubG9nKFsuLi5Xb3JsZC5zeXN0ZW1zXSlcclxuXHRjb25zb2xlLmxvZyhNZXNoLlByaW1pdGl2ZXMucXVhZClcclxuXHJcblx0V29ybGQuc3lzdGVtcy5yZW1vdmUoR3Jhdml0eVN5c3RlbSlcclxuXHRXb3JsZC5zeXN0ZW1zLmdldChSZW5kZXJTeXN0ZW0pLmZpdCgpXHJcblx0UG9uZy5yZXNldFJvdW5kKClcclxufVxyXG5cclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNzcFwiKS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gcGxheShcInNwXCIpKVxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2hvc3RcIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHBsYXkoXCJob3N0XCIpKVxyXG5kb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2pvaW5cIikuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHBsYXkoXCJndWVzdFwiKSlcclxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcjxIVE1MSW5wdXRFbGVtZW50PihcIiNjb2RlID4gaW5wdXRcIikuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgZSA9PiB7XHJcblx0c3dpdGNoKGUua2V5Q29kZSkge1xyXG5cdFx0Y2FzZSAxMzpcclxuXHRcdFx0cGxheShcImd1ZXN0XCIpXHJcblx0XHRcdGJyZWFrXHJcblx0fVxyXG59KVxyXG5cclxuZnVuY3Rpb24gaGFzUGFyYW1ldGVyKG5hbWU6IHN0cmluZykge1xyXG5cdHJldHVybiBsb2NhdGlvbi5oYXNoLnNsaWNlKDEpLnNwbGl0KCcsJykuaW5kZXhPZihuYW1lKSAhPSAtMVxyXG59XHJcblxyXG5pZihoYXNQYXJhbWV0ZXIoXCJzaW5nbGVwbGF5ZXJcIikpXHJcblx0cGxheShcInNwXCIpXHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb25nIHtcclxuXHRwdWJsaWMgc3RhdGljIHJlc2V0Um91bmQoKTogdm9pZCB7XHJcblx0XHRXb3JsZC5lbnRpdGllcy5mb3JFYWNoKChiYWxsLCBtb3Rpb24sIHRyYW5zZm9ybSkgPT4ge1xyXG5cdFx0XHRsZXQgc3BlZWQgPSAwLjJcclxuXHRcdFx0bGV0IGFuZ2xlID0gTWF0aC5yb3VuZChNYXRoLnJhbmRvbSgpICogMTUpICogTWF0aC5QSSAvIDdcclxuXHRcdFx0bW90aW9uLnZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoTWF0aC5jb3MoYW5nbGUpLCBNYXRoLnNpbihhbmdsZSkpLm11bCgwLjIpXHJcblx0XHRcdHRyYW5zZm9ybS5wb3NpdGlvbiA9IG5ldyBWZWN0b3IzKDAsIChNYXRoLnJhbmRvbSgpIC0gMC41KSAqIFBvbmcuaGVpZ2h0KVxyXG5cclxuXHRcdFx0aWYoaGFzUGFyYW1ldGVyKFwiZGV0ZXJtaW5pc3RpY1wiKSkge1xyXG5cdFx0XHRcdG1vdGlvbi52ZWxvY2l0eSA9IG5ldyBWZWN0b3IzKC1zcGVlZClcclxuXHRcdFx0XHR0cmFuc2Zvcm0ucG9zaXRpb24gPSBWZWN0b3IzLnplcm9cclxuXHRcdFx0fVxyXG5cdFx0fSwgQmFsbCwgTW90aW9uLCBUcmFuc2Zvcm0pXHJcblxyXG5cdFx0U2ltdWxhdG9yLnJlc3VtZSgpXHJcblx0fVxyXG5cclxuXHRwdWJsaWMgc3RhdGljIGdldCB3aWR0aCgpIHtcclxuXHRcdHJldHVybiAxMlxyXG5cdH1cclxuXHJcblx0cHVibGljIHN0YXRpYyBnZXQgaGVpZ2h0KCkge1xyXG5cdFx0cmV0dXJuIDhcclxuXHR9XHJcbn1cclxuXHJcbkBXb3JsZC5yZWdpc3Rlci5zeXN0ZW0oU2ltdWxhdG9yLnBoYXNlKFNpbXVsYXRvci5DYXRlZ29yeS5VSSwge2FmdGVyOiBbVGV4dFN5c3RlbV19KSlcclxuY2xhc3MgRGVidWdTeXN0ZW0gZXh0ZW5kcyBTeXN0ZW0ge1xyXG5cdHB1YmxpYyB1cGRhdGUoZW50aXRpZXM6IEVudGl0aWVzKTogdm9pZCB7XHJcblx0XHRsZXQgdGV4dFN5c3RlbSA9IFdvcmxkLnN5c3RlbXMuZ2V0KFRleHRTeXN0ZW0pXHJcblxyXG5cdFx0ZW50aXRpZXMuZm9yRWFjaCgodHJhbnNmb3JtLCBuYW1lKSA9PiB7XHJcblx0XHRcdHRleHRTeXN0ZW0udGV4dCh0cmFuc2Zvcm0ucG9zaXRpb24sIGAke25hbWV9YCwge2NvbG9yOiBcImRpbWdyYXlcIn0pXHJcblx0XHR9LCBUcmFuc2Zvcm0sIE5hbWUpXHJcblx0fVxyXG59Il19