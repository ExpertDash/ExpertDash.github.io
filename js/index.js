import * as cobrasu from "/lib/cobrasu/core.js";
import "./core/damageCalculator.js";
import Gun from "./core/gun.js";
import "./core/simulation.js";
import CardList from "./ui/cardList.js";
import GunList from "./ui/gunList.js";
import ScenarioElement from "./ui/scenarioElement.js";
import TTKGraph from "./ui/ttkGraph.js";
const { Cookies, Content } = cobrasu.DOM;
let mainArgEntries = location
    .search
    .substring(1)
    .split("&")
    .map(pair => {
    let [key, value] = pair.split("=");
    key ??= null;
    value ??= null;
    return [key, value];
});
let mainArgs = Object.fromEntries(mainArgEntries);
window.onload = async () => {
    //Bind elements
    let scenario = new ScenarioElement(document.querySelector("#scenario"), {
        defaultScenario: {
            health: 250,
            distance: 100,
            regions: ["head", "neck", "chest", "stomach", "limbs"],
            distribution: {
                head: 0.1,
                neck: 0.1,
                chest: 0.3,
                stomach: 0.13,
                limbs: 0.37
            }
        }
    });
    scenario.element.querySelector("#import").onclick = () => {
        let url = prompt("Google Sheets Url");
        if (!url)
            return;
        let [id] = url
            .match(/docs\.google\.com\/spreadsheets\/d\/([0-9a-zA-Z]+)\//)
            .slice(1);
        if (!id)
            return;
        location.search = `id=${id}`;
    };
    scenario.element.querySelector("#refresh").onclick = () => location.reload();
    scenario.element.querySelector("#view").onclick = () => {
        if (!("id" in mainArgs))
            return;
        open(`https://docs.google.com/spreadsheets/d/${mainArgs.id}`, "_blank").focus();
    };
    let graph = new TTKGraph(document.querySelector("#ttkd > canvas"));
    let cards = new CardList(document.querySelector("#cards"), {
        graph: graph
    });
    //Acquire gun data from spreadsheet based on page id
    let discoveredGuns = [];
    try {
        if ("id" in mainArgs)
            discoveredGuns = Gun.parseCSV(await Content.fetch(`https://docs.google.com/spreadsheets/d/${mainArgs.id}/export?format=csv`));
    }
    catch (e) {
        console.error(e);
    }
    let guns = new GunList(document.querySelector("#glist"), {
        cards: cards,
        guns: discoveredGuns
    });
    console.log(`Loaded ${[...guns].length} guns`);
    //Display scenario
    function update(scenario) {
        graph.scenario = scenario;
        cards.update(scenario);
    }
    update(scenario.value);
    scenario.element.addEventListener("scenarioChange", (e) => {
        let scenario = e.detail;
        update(scenario);
    });
    //Show selection
    for (let gunName of Object.keys(Cookies.get("selection", Object, {}))) {
        if (!guns.registry.has(gunName))
            continue;
        let item = guns.registry.get(gunName);
        item.visibility.checked = true;
        cards.add(item.gun);
    }
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxLQUFLLE9BQU8sTUFBTSxzQkFBc0IsQ0FBQTtBQUMvQyxPQUE2Qiw0QkFBNEIsQ0FBQTtBQUN6RCxPQUFPLEdBQUcsTUFBTSxlQUFlLENBQUE7QUFDL0IsT0FBdUIsc0JBQXNCLENBQUE7QUFDN0MsT0FBTyxRQUFRLE1BQU0sa0JBQWtCLENBQUE7QUFDdkMsT0FBTyxPQUFPLE1BQU0saUJBQWlCLENBQUE7QUFDckMsT0FBTyxlQUFlLE1BQU0seUJBQXlCLENBQUE7QUFDckQsT0FBTyxRQUFRLE1BQU0sa0JBQWtCLENBQUE7QUFFdkMsTUFBTSxFQUFDLE9BQU8sRUFBRSxPQUFPLEVBQUMsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFBO0FBRXRDLElBQUksY0FBYyxHQUFHLFFBQVE7S0FDM0IsTUFBTTtLQUNOLFNBQVMsQ0FBQyxDQUFDLENBQUM7S0FDWixLQUFLLENBQUMsR0FBRyxDQUFDO0tBQ1YsR0FBRyxDQUFDLElBQUksQ0FBQyxFQUFFO0lBQ1gsSUFBSSxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFBO0lBQ2xDLEdBQUcsS0FBSyxJQUFJLENBQUE7SUFDWixLQUFLLEtBQUssSUFBSSxDQUFBO0lBRWQsT0FBTyxDQUFDLEdBQUcsRUFBRSxLQUFLLENBQUMsQ0FBQTtBQUNwQixDQUFDLENBQUMsQ0FBQTtBQUVILElBQUksUUFBUSxHQUE0QixNQUFNLENBQUMsV0FBVyxDQUFDLGNBQWMsQ0FBQyxDQUFBO0FBRTFFLE1BQU0sQ0FBQyxNQUFNLEdBQUcsS0FBSyxJQUFJLEVBQUU7SUFDMUIsZUFBZTtJQUNmLElBQUksUUFBUSxHQUFHLElBQUksZUFBZSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLEVBQUU7UUFDdkUsZUFB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RSxJQUFJLFFBQVEsR0FBRyxDQUFDLENBQUMsTUFBNkIsQ0FBQTtRQUM5QyxNQUFNLENBQUMsUUFBUSxDQUFDLENBQUE7SUFDakIsQ0FBQyxDQUFDLENBQUE7SUFFRixnQkFBZ0I7SUFDaEIsS0FBSSxJQUFJLE9BQU8sSUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQTBCLFdBQVcsRUFBRSxNQUFNLEVBQUUsRUFBRSxDQUFDLENBQUMsRUFBRTtRQUM5RixJQUFHLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDO1lBQzdCLFNBQVE7UUFFVCxJQUFJLElBQUksR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEdBQUcsQ0FBQyxPQUFPLENBQUMsQ0FBQTtRQUVyQyxJQUFJLENBQUMsVUFBVSxDQUFDLE9BQU8sR0FBRyxJQUFJLENBQUE7UUFDOUIsS0FBSyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDbkI7QUFDRixDQUFDLENBQUEiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBjb2JyYXN1IGZyb20gXCIvbGliL2NvYnJhc3UvY29yZS5qc1wiXG5pbXBvcnQgRGFtYWdlQ2FsY3VsYXRvciBmcm9tIFwiLi9jb3JlL2RhbWFnZUNhbGN1bGF0b3IuanNcIlxuaW1wb3J0IEd1biBmcm9tIFwiLi9jb3JlL2d1bi5qc1wiXG5pbXBvcnQgU2ltdWxhdGlvbiBmcm9tIFwiLi9jb3JlL3NpbXVsYXRpb24uanNcIlxuaW1wb3J0IENhcmRMaXN0IGZyb20gXCIuL3VpL2NhcmRMaXN0LmpzXCJcbmltcG9ydCBHdW5MaXN0IGZyb20gXCIuL3VpL2d1bkxpc3QuanNcIlxuaW1wb3J0IFNjZW5hcmlvRWxlbWVudCBmcm9tIFwiLi91aS9zY2VuYXJpb0VsZW1lbnQuanNcIlxuaW1wb3J0IFRUS0dyYXBoIGZyb20gXCIuL3VpL3R0a0dyYXBoLmpzXCJcblxuY29uc3Qge0Nvb2tpZXMsIENvbnRlbnR9ID0gY29icmFzdS5ET01cblxubGV0IG1haW5BcmdFbnRyaWVzID0gbG9jYXRpb25cblx0LnNlYXJjaFxuXHQuc3Vic3RyaW5nKDEpXG5cdC5zcGxpdChcIiZcIilcblx0Lm1hcChwYWlyID0+IHtcblx0XHRsZXQgW2tleSwgdmFsdWVdID0gcGFpci5zcGxpdChcIj1cIilcblx0XHRrZXkgPz89IG51bGxcblx0XHR2YWx1ZSA/Pz0gbnVsbFxuXG5cdFx0cmV0dXJuIFtrZXksIHZhbHVlXVxuXHR9KVxuXG5sZXQgbWFpbkFyZ3M6IHtba2V5OiBzdHJpbmddOiBzdHJpbmd9ID0gT2JqZWN0LmZyb21FbnRyaWVzKG1haW5BcmdFbnRyaWVzKVxuXG53aW5kb3cub25sb2FkID0gYXN5bmMgKCkgPT4ge1xuXHQvL0JpbmQgZWxlbWVudHNcblx0bGV0IHNjZW5hcmlvID0gbmV3IFNjZW5hcmlvRWxlbWVudChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3NjZW5hcmlvXCIpLCB7XG5cdFx0ZGVmYXVsdFNjZW5hcmlvOiB7XG5cdFx0XHRoZWFsdGg6IDI1MCxcblx0XHRcdGRpc3RhbmNlOiAxMDAsXG5cdFx0XHRyZWdpb25zOiBbXCJoZWFkXCIsIFwibmVja1wiLCBcImNoZXN0XCIsIFwic3RvbWFjaFwiLCBcImxpbWJzXCJdLFxuXHRcdFx0ZGlzdHJpYnV0aW9uOiB7XG5cdFx0XHRcdGhlYWQ6IDAuMSxcblx0XHRcdFx0bmVjazogMC4xLFxuXHRcdFx0XHRjaGVzdDogMC4zLFxuXHRcdFx0XHRzdG9tYWNoOiAwLjEzLFxuXHRcdFx0XHRsaW1iczogMC4zN1xuXHRcdFx0fVxuXHRcdH1cblx0fSlcblxuXHRzY2VuYXJpby5lbGVtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTEJ1dHRvbkVsZW1lbnQ+KFwiI2ltcG9ydFwiKS5vbmNsaWNrID0gKCkgPT4ge1xuXHRcdGxldCB1cmwgPSBwcm9tcHQoXCJHb29nbGUgU2hlZXRzIFVybFwiKVxuXG5cdFx0aWYoIXVybClcblx0XHRcdHJldHVyblxuXG5cdFx0bGV0IFtpZF0gPSB1cmxcblx0XHRcdC5tYXRjaCgvZG9jc1xcLmdvb2dsZVxcLmNvbVxcL3NwcmVhZHNoZWV0c1xcL2RcXC8oWzAtOWEtekEtWl0rKVxcLy8pXG5cdFx0XHQuc2xpY2UoMSlcblxuXHRcdGlmKCFpZClcblx0XHRcdHJldHVyblxuXG5cdFx0bG9jYXRpb24uc2VhcmNoID0gYGlkPSR7aWR9YFxuXHR9XG5cblx0c2NlbmFyaW8uZWxlbWVudC5xdWVyeVNlbGVjdG9yPEhUTUxCdXR0b25FbGVtZW50PihcIiNyZWZyZXNoXCIpLm9uY2xpY2sgPSAoKSA9PiBsb2NhdGlvbi5yZWxvYWQoKVxuXHRzY2VuYXJpby5lbGVtZW50LnF1ZXJ5U2VsZWN0b3I8SFRNTEJ1dHRvbkVsZW1lbnQ+KFwiI3ZpZXdcIikub25jbGljayA9ICgpID0+IHtcblx0XHRpZighKFwiaWRcIiBpbiBtYWluQXJncykpXG5cdFx0XHRyZXR1cm5cblxuXHRcdG9wZW4oYGh0dHBzOi8vZG9jcy5nb29nbGUuY29tL3NwcmVhZHNoZWV0cy9kLyR7bWFpbkFyZ3MuaWR9YCwgXCJfYmxhbmtcIikuZm9jdXMoKVxuXHR9XG5cblx0bGV0IGdyYXBoID0gbmV3IFRUS0dyYXBoKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdHRrZCA+IGNhbnZhc1wiKSlcblx0XG5cdGxldCBjYXJkcyA9IG5ldyBDYXJkTGlzdChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NhcmRzXCIpLCB7XG5cdFx0Z3JhcGg6IGdyYXBoXG5cdH0pXG5cdFxuXHQvL0FjcXVpcmUgZ3VuIGRhdGEgZnJvbSBzcHJlYWRzaGVldCBiYXNlZCBvbiBwYWdlIGlkXG5cdGxldCBkaXNjb3ZlcmVkR3VuczogR3VuW10gPSBbXVxuXG5cdHRyeSB7XG5cdFx0aWYoXCJpZFwiIGluIG1haW5BcmdzKVxuXHRcdFx0ZGlzY292ZXJlZEd1bnMgPSBHdW4ucGFyc2VDU1YoYXdhaXQgQ29udGVudC5mZXRjaChgaHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vc3ByZWFkc2hlZXRzL2QvJHttYWluQXJncy5pZH0vZXhwb3J0P2Zvcm1hdD1jc3ZgKSlcblx0fSBjYXRjaChlKSB7XG5cdFx0Y29uc29sZS5lcnJvcihlKVxuXHR9XG5cblx0bGV0IGd1bnMgPSBuZXcgR3VuTGlzdChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2dsaXN0XCIpLCB7XG5cdFx0Y2FyZHM6IGNhcmRzLFxuXHRcdGd1bnM6IGRpc2NvdmVyZWRHdW5zXG5cdH0pXG5cblx0Y29uc29sZS5sb2coYExvYWRlZCAke1suLi5ndW5zXS5sZW5ndGh9IGd1bnNgKVxuXG5cdC8vRGlzcGxheSBzY2VuYXJpb1xuXHRmdW5jdGlvbiB1cGRhdGUoc2NlbmFyaW86IFNpbXVsYXRpb24uU2NlbmFyaW8pOiB2b2lkIHtcblx0XHRncmFwaC5zY2VuYXJpbyA9IHNjZW5hcmlvXG5cdFx0Y2FyZHMudXBkYXRlKHNjZW5hcmlvKVxuXHR9XG5cblx0dXBkYXRlKHNjZW5hcmlvLnZhbHVlKVxuXG5cdHNjZW5hcmlvLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcInNjZW5hcmlvQ2hhbmdlXCIsIChlOiBDdXN0b21FdmVudCkgPT4ge1xuXHRcdGxldCBzY2VuYXJpbyA9IGUuZGV0YWlsIGFzIFNpbXVsYXRpb24uU2NlbmFyaW9cblx0XHR1cGRhdGUoc2NlbmFyaW8pXG5cdH0pXG5cblx0Ly9TaG93IHNlbGVjdGlvblxuXHRmb3IobGV0IGd1bk5hbWUgb2YgT2JqZWN0LmtleXMoQ29va2llcy5nZXQ8e1trZXk6IHN0cmluZ106IG9iamVjdH0+KFwic2VsZWN0aW9uXCIsIE9iamVjdCwge30pKSkge1xuXHRcdGlmKCFndW5zLnJlZ2lzdHJ5LmhhcyhndW5OYW1lKSlcblx0XHRcdGNvbnRpbnVlXG5cblx0XHRsZXQgaXRlbSA9IGd1bnMucmVnaXN0cnkuZ2V0KGd1bk5hbWUpXG5cblx0XHRpdGVtLnZpc2liaWxpdHkuY2hlY2tlZCA9IHRydWVcblx0XHRjYXJkcy5hZGQoaXRlbS5ndW4pXG5cdH1cbn0iXX0=